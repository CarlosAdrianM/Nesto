<UserControl x:Class="Nesto.Modulos.Cajas.Views.MayorCuentaView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:controles="clr-namespace:ControlesUsuario;assembly=ControlesUsuario"
             mc:Ignorable="d"
             d:DesignHeight="400" d:DesignWidth="500"
             prism:ViewModelLocator.AutoWireViewModel="True"
             Background="White">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </UserControl.Resources>

    <xctk:BusyIndicator IsBusy="{Binding EstaOcupado}" BusyContent="Generando Mayor...">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="20"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="15"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="15"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="15"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="15"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="20"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="15"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Titulo -->
            <TextBlock Grid.Row="0" Grid.ColumnSpan="3"
                       Text="Mayor de Cliente/Proveedor"
                       FontSize="20" FontWeight="Bold"
                       HorizontalAlignment="Center"/>

            <!-- Tipo de cuenta -->
            <TextBlock Grid.Row="2" Grid.Column="0"
                       Text="Tipo de cuenta:"
                       VerticalAlignment="Center"/>
            <StackPanel Grid.Row="2" Grid.Column="2" Orientation="Horizontal">
                <RadioButton Content="Cliente"
                             IsChecked="{Binding EsCliente}"
                             Margin="0,0,20,0"
                             VerticalAlignment="Center"/>
                <RadioButton Content="Proveedor"
                             IsChecked="{Binding EsProveedor}"
                             VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Selector de Cliente o Proveedor -->
            <TextBlock Grid.Row="4" Grid.Column="0"
                       Text="Numero:"
                       VerticalAlignment="Center"/>
            <Grid Grid.Row="4" Grid.Column="2">
                <!-- Selector de Cliente (visible cuando EsCliente = true) -->
                <controles:SelectorCliente
                    Name="txtSelectorCliente"
                    Empresa="1"
                    Cliente="{Binding Path=DataContext.NumeroCuenta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Etiqueta=""
                    Visibility="{Binding Path=DataContext.EsCliente, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}"
                    HorizontalAlignment="Stretch"/>

                <!-- Selector de Proveedor (visible cuando EsCliente = false) -->
                <controles:SelectorProveedor
                    Name="txtSelectorProveedor"
                    Empresa="1"
                    Proveedor="{Binding Path=DataContext.NumeroCuenta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Etiqueta=""
                    Visibility="{Binding Path=DataContext.EsProveedor, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}"
                    HorizontalAlignment="Stretch"/>
            </Grid>

            <!-- Fecha Desde -->
            <TextBlock Grid.Row="6" Grid.Column="0"
                       Text="Fecha desde:"
                       VerticalAlignment="Center"/>
            <DatePicker Grid.Row="6" Grid.Column="2"
                        SelectedDate="{Binding FechaDesde}"
                        Width="150"
                        HorizontalAlignment="Left"/>

            <!-- Fecha Hasta -->
            <TextBlock Grid.Row="8" Grid.Column="0"
                       Text="Fecha hasta:"
                       VerticalAlignment="Center"/>
            <DatePicker Grid.Row="8" Grid.Column="2"
                        SelectedDate="{Binding FechaHasta}"
                        Width="150"
                        HorizontalAlignment="Left"/>

            <!-- Checkbox Solo Facturas -->
            <CheckBox Grid.Row="10" Grid.Column="2"
                      Content="Solo listado facturas"
                      IsChecked="{Binding SoloFacturas}"
                      ToolTip="Si esta marcado, solo muestra los movimientos de tipo Factura (TipoApunte = 1)"
                      VerticalAlignment="Center"/>

            <!-- Checkbox Eliminar Paso a Cartera -->
            <CheckBox Grid.Row="10" Grid.Column="2"
                      Margin="180,0,0,0"
                      Content="Eliminar paso a cartera"
                      IsChecked="{Binding EliminarPasoACartera}"
                      ToolTip="Elimina los pares Factura+PasoACartera que se anulan entre si. Util para ver solo los movimientos relevantes."
                      VerticalAlignment="Center"/>

            <!-- Boton Ver Mayor -->
            <Button Grid.Row="12" Grid.Column="2"
                    Command="{Binding VerMayorCommand}"
                    Content="Ver Mayor"
                    Padding="25,10"
                    HorizontalAlignment="Left"
                    FontSize="14"/>

            <!-- Mensaje de Estado -->
            <TextBlock Grid.Row="13" Grid.Column="0" Grid.ColumnSpan="3"
                       Text="{Binding MensajeEstado}"
                       VerticalAlignment="Bottom"
                       Foreground="Green"
                       FontStyle="Italic"/>
        </Grid>
    </xctk:BusyIndicator>
</UserControl>
